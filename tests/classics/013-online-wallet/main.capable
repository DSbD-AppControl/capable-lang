{- OnlineWallet
   Fails due to plain merge rather than full merge
-}

role Server
role Client
role Authenticator

struct loginDetails { id : String ; password : String }
union login { login : Unit }

union authenticate { success : Unit ; error : String }

struct accountDetails { balance : Int ; overdraft : Int }
union account { account : accountDetails }

struct payDetails { payee : String ; amount : Int }
union cmd { pay : payDetails ; quit : Unit }

union msg { msg : String }

protocol OnlineWallet
    = Client        ==> Authenticator [login] { login(Unit)
    . Authenticator ==> Client        [authenticate]
      { success (Unit)
        . Authenticator ==> Server [msg]     { msg(String)
        . Server        ==> Client [account] { account(accountDetails)
          . rec(Loop)
            . Client ==> Server [cmd]
              { pay (payDetails)
                . call(Loop)
              | quit (Unit)
                . end
              }}}
      | error(String)
        . Authenticator ==> Server [msg]{ msg(String)
        . end
}}}


main (args : [String])
{
  print("My First Program")
; print(toString('\n'))

}
